- model: shadow-removal
  operations:
    train:
      plugins: [cpu, gpu, memory]
      main: src/main
      label: ${tasks}_${D-loss-fn}_${D-loss-type}_${net-D}-${net-G}
      sourcecode:
        select:
          - 'src/*'
      flags-dest: args
      flags:
        tasks: train
        D-loss-fn:
          default: leastsquare
          choices: [standard, leastsquare]
        D-loss-type:
          default: normal
          choices: [normal, rel, rel_avg]
        NN-upconv: yes
        activation: sigmoid
        batch-size: 8
        beta1: 0.5
        beta2: 0.999
        data-dir: ./ISTD_Dataset.hdf5
        decay: 5.0e-05
        devices: cuda
        epochs: 2000
        logs: ./logs
        lr-D:
          default:
          type: float
        lr-G:
          default:
          type: float
        net-D: patchgan
        net-G: mnet
        # softadapt: yes
        weights: ./weights
        workers: 4
      output-scalars: off
      # requires:
      #   - dataset

    infer:
      main: src/main
      label: ${tasks}_${net-D}-${net-G}
      plugins: [cpu, gpu, memory]
      sourcecode:
        select:
          - 'src/*'
      flags-dest: args
      flags:
        tasks: infer
        NN-upconv: yes
        batch-size: 2
        data-dir: ./ISTD_Dataset.hdf5
        devices: cuda
        infered: ./infered
        load-weights-g1:
          required: yes
        load-weights-g2:
          required: yes
        logs: ./logs
        net-D: patchgan
        net-G: mnet
        workers: 2
      output-scalars: off
      # requires:
      #   - dataset
        # - file: ./weights_lr0.00005_RaLSGAN/MNet_latest.pt

- model: STCGAN
  operations:
    train:
      plugins: [cpu, gpu, memory]
      main: STCGAN/main
      label: ${tasks}_${D-loss-fn}_${D-loss-type}
      sourcecode:
        select:
          - 'STCGAN/*'
      flags-dest: args
      flags:
        tasks: train
        D-loss-fn:
          default: leastsquare
          choices: [standard, leastsquare]
        D-loss-type:
          default: rel_avg
          choices: [normal, rel, rel_avg]
        # NN-upconv: yes
        batch-size: 8
        beta1: 0.5
        beta2: 0.999
        data-dir: ./ISTD_DATASET
        decay: 5.0e-05
        devices: cuda
        epochs: 2000
        logs: ./logs
        load-weights-g1:
        load-weights-g2:
        load-weights-d1:
        load-weights-d2:
        lr-D:
          default:
          type: float
        lr-G:
          default:
          type: float
        # softadapt: yes
        weights: ./weights
        workers: 4
      output-scalars: off
      # requires:
      #   - dataset

    infer:
      main: STCGAN/main
      label: ${tasks}
      plugins: [cpu, gpu, memory]
      sourcecode:
        select:
          - 'STCGAN/*'
      flags-dest: args
      flags:
        tasks: infer
        # NN-upconv: yes
        batch-size: 2
        data-dir: ./ISTD_DATASET
        devices: cuda
        infered: ./infered
        load-weights-g1:
          required: yes
        load-weights-g2:
          required: yes
        logs: ./logs
        workers: 2
      output-scalars: off
      # requires:
      #   - dataset

  # resources:
  #   dataset:
    # - file: ./ISTD_DATASET
